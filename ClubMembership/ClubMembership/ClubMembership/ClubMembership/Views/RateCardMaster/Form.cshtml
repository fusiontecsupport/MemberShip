@using ClubMembership.Models;
@model ClubMembership.Models.MaterialMaster
@{
    ViewBag.Title = "State Wise Rate Card";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="col-lg-12">
    <div class="panel panel-primary">
        <div class="panel-heading">
            <h3 class="panel-title"><i class="fa fa-bar-chart-o fa-fw"></i>  State Wise Rate Card  <div class="clearfix"> </div></h3>
        </div>

        @Html.Raw(ViewBag.msg)
        <div class="row">
            <div class="col-md-12">
                <div class="panel-body">
                    <form action="#" method="post" accept-charset="utf-8" id="newconsolidatedform" data-ng-controller="myController" name="newconsolidatedform">

                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <label for="from">W.E.From</label>
                                        <input type="text" id="from" class="form-control from" name="from" value="@System.Web.HttpContext.Current.Session["SDATE"]" onchange="GetWEDate()">
                                        <label for="to" class="hidden">to</label>
                                        <input type="text" id="to" class="to hidden" name="to" value="@System.Web.HttpContext.Current.Session["EDATE"]">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>State Name</label>
                                        @Html.DropDownList("STATEID", null, new { @class = "form-control STATEID", @id = "STATEID", @name = "STATEID" })
                                        @*<input type="text" value="0" name="MSTATEID" id="MSTATEID" class="form-control MSTATEID" >*@
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Material Group</label>
                                        @Html.DropDownList("MTRLGID", null, "Select", new {@class = "form-control MTRLGID",@id = "MTRLGID"@*, @onchange = "GetMaterialList()"*@ }) <br />
                                        <input type="button" name="submit" value="Search" class="btn btn-danger btn-sm" onclick="GetMaterialList()" />
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">

                                    </div>
                                </div>
                            </div>


                        </div>




                    </form>
                    <form action="@Url.Action("savedata", "RateCard")" method="post" accept-charset="utf-8" id="RateCardform" data-ng-controller="myController" name="RateCardform" onsubmit="return validate()">
                        <div class="panel-body fusion_frm">
                            <input type="text" id="TRANDATE" class="TRANDATE hidden" name="TRANDATE" value="@System.Web.HttpContext.Current.Session["SDATE"]">

                            <div class="row">
                                <div class="panel-body">
                                    <div class="table-responsive" id="job_list_inner">
                                        <input type="text" id="TDETAIL_IDX" value="0" name="TDETAIL_IDX[]" class="TDETAIL_IDX" style="display:none" />
                                        <table class='table table-striped table-bordered bootstrap-datatable' id="TDETAIL">

                                            <thead>

                                                <tr>
                                                    <th>Group</th>
                                                    <th>Material</th>
                                                    <th>Rate</th>
                                                </tr>
                                            </thead>
                                            <tbody class="TDETAIL_BODY" id="TDETAIL_BODY"><tr><td colspan="6" class="text-center">No Records Found</td></tr></tbody>
                                        </table>

                                    </div>
                                </div>
                                <!-- /.row (nested) -->
                            </div>

                            <div class="col-md-12 box-footer">
                                @*<a href="@Url.Action("Index", "RateCard")" class="btn btn-primary btn-xs  pull-left" tabindex="3001">Go Back</a>
                                    <input type="button" name="submit" value="Submit" class="btn btn-success btn-xs" tabindex="3002" onclick="GeneratePriceList()" />*@

                                <input type="button" name="back" value="Go Back" class="btn btn-primary" onclick="JavaScript:history.back()" tabindex="3001" />
                                <input type="submit" name="submit" value="Submit" class="btn btn-primary pull-right" tabindex="3002" onclick="GeneratePriceList()" />

                            </div>
                            <!-- /.panel-body -->
                        </div>


                    </form>
                </div>
            </div>
        </div>


    </div>
</div>
@section Scripts {

    <script type="text/javascript">
        function GetWEDate() {
            $(".TRANDATE").val($(".from").val());
        }

        //$("#STATEID").on("change", function () {
        //    var sname = $('#STATEID :selected').text();
        //    var sid = $('#STATEID :selected').val();
        //    //alert(bname);
        //    //alert(bid);
        //    $("#MSTATEID").val(sid);

        //});

        function GeneratePriceList() {
            $.ajax({
                type: 'post',
                url: '@Url.Action("savedata", "RateCardMaster")', // we are calling json method
                data: $("#RateCardform").serialize(),
                success: function (data) {
                    if (data = "Saved Successfully") {
                        alert(data); location.replace('@Url.Action("Index", "RateCardMaster")');
                    }
                    else {
                        alert(data); location.reload();
                    }
                },
                error: function (ex) {
                    alert('Failed to data ' + ex);
                }
            });

        }

        function GetMaterialList() {
            if ($(".MTRLGID").val() == "") {
                alert("Kindly select Material Group before search");
                $(".MTRLGID").focus();
                return false;
            }
            $(".TDETAIL_BODY").html("");
            $.ajax({
                type: 'post',
                url: '@Url.Action("DisplayMaterialList", "RateCardMaster")/' + $(".MTRLGID option:selected").val() + ";"  + $(".STATEID option:selected").val(),// + ";" + $(".Subcategory option:selected").val(), // we are calling json method

                success: function (data) {
                    if(data.length>0)
                        $(".TDETAIL_BODY").html(data);
                    else
                         alert("No records found...");

                },
                error: function (ex) {
                    alert('Failed to data ' + ex);
                }
            });
        }



        $(function () {
            $("#from").datepicker({
                changeMonth: true,
                dateFormat: 'dd-mm-yy'
            });
        })
    </script>
}










