<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>SNGS</title>

    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/jquery.datetimepicker.css" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
    <link href="~/Content/themes/base/minified/jquery-ui.css" rel="stylesheet" />
    <link href="~/Content/themes/base/minified/jquery.ui.datepicker.min.css" rel="stylesheet" />
    <link href="~/Content/themes/base/minified/jquery-ui.theme.min.css" rel="stylesheet" />
    <link href="~/Content/sweetalert2.min.css" rel="stylesheet" />
    <!----------------------------------->
    @*<link rel="stylesheet" type="text/css" href="~/Scripts/sweetalert2/dist/sweetalert2.min.css" />*@
    <!-------------------------------------->
    <link rel="stylesheet" type="text/css" href="~/crmassets/select2/css/select2.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Font Awesome 6 (Free version) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
          integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer" />
    <!-- Add Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    @Styles.Render("~/Content/css")
    @RenderSection("Styles", required: false)
    @*@RenderSection("Scripts", required: false)*@


    


    <style>
        #save {
            cursor: pointer;
        }

        #submit {
            cursor: pointer;
        }

        #save {
            cursor: pointer;
        }

        #checkbox {
            cursor: pointer;
        }


        /* Top Navigation */

        .top-nav {
            padding: 15px 15px;
        }

            .top-nav > li {
                display: inline-block;
                float: left;
            }

                .top-nav > li > a {
                    padding-top: 15px;
                    padding-bottom: 15px;
                    line-height: 20px;
                    color: #fff;
                }

                    .top-nav > li > a:hover,
                    .top-nav > li > a:focus,
                    .top-nav > .open > a,
                    .top-nav > .open > a:hover,
                    .top-nav > .open > a:focus {
                        color: #fff;
                        background-color: #000;
                    }

            .top-nav > .open > .dropdown-menu {
                float: left;
                position: absolute;
                margin-top: 0;
                border: 1px solid rgba(0,0,0,.15);
                border-top-left-radius: 0;
                border-top-right-radius: 0;
                background-color: #fff;
                -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
                box-shadow: 0 6px 12px rgba(0,0,0,.175);
                min-width: 200px;
            }

                .top-nav > .open > .dropdown-menu > li > a {
                    white-space: normal;
                    border: 1px dotted rgba(0,0,0,.175);
                }

        ul.message-dropdown {
            padding: 0;
            max-height: 250px;
            overflow-x: hidden;
            overflow-y: auto;
        }

        li.message-preview {
            width: 275px;
            border-bottom: 1px solid rgba(0,0,0,.15);
        }

            li.message-preview > a {
                padding-top: 15px;
                padding-bottom: 15px;
            }

        li.message-footer {
            margin: 5px 0;
        }

        ul.alert-dropdown {
            width: 200px;
        }


        .footer {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            text-align: center;
            padding: 5px 5px 0px 5px;
            margin: 0;
            height: 25px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .footer p { margin: 0; }

        .navbar-inverse {
            /*background:#003366; border-radius:0; color:#fff;*/
            background: #000;
            border-radius: 0;
            color: #fff;
            height: 70px;
        }


        .alert {
            padding: 5px 0 5px 0;
        }

        /* Avoid content being hidden behind fixed footer */
        #page-wrapper {
            padding-bottom: 40px; /* space for footer */
        }

        /* Footer link styling */
        .footer a {
            color: inherit;
            text-decoration: none;
            font-weight: 600;
        }
        .footer a:hover {
            text-decoration: underline;
        }
    </style>



</head>

<body>

    <div id="BaseUrl" data-baseurl="@Context.Request.Url.GetLeftPart(UriPartial.Authority)" data-virtualpath="/sngs"></div>
    <div id="1wrapper">
        @Html.Action("Navbar", "Navbar", new { controller = ViewContext.RouteData.Values["Controller"].ToString(), action = ViewContext.RouteData.Values["Action"].ToString() })

        <div id="page-wrapper">
            @RenderBody()
        </div>
    </div>
    <!-- /#wrapper -->



    @Scripts.Render("~/bundles/jquery")
    <script src="~/Scripts/jquery.validate.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.js"></script>
    @Scripts.Render("~/bundles/bootstrap")

    @*<script type="text/javascript" language="javascript" src="../../Scripts/foundation/foundation.js"></script>
        <link rel="stylesheet" href="//code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css">
        <script src="//code.jquery.com/jquery-1.10.2.js"></script>
        <script src="//code.jquery.com/ui/1.11.0/jquery-ui.js"></script>
        <script src="~/Scripts/jquery.datetimepicker.js"></script>*@

    <script src="~/Scripts/jquery-ft-min.js"></script>
    <script src="~/Scripts/jquery.validate.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
    }

    @*<script type="text/javascript" language="javascript" src="//code.jquery.com/jquery-1.12.4.js">
        </script>*@
    <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js">
    </script>

    <script>
        // Normalize corrupted bullet characters (mojibake) across the whole page
        (function () {
            var BAD = 'â€¢';
            var FIX = ' | ';

            function replaceInTextNodes(root) {
                var walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, null, false);
                var node;
                while ((node = walker.nextNode())) {
                    if (node.parentNode && (node.parentNode.tagName === 'SCRIPT' || node.parentNode.tagName === 'STYLE')) continue;
                    if (node.nodeValue && node.nodeValue.indexOf(BAD) !== -1) {
                        node.nodeValue = node.nodeValue.split(BAD).join(FIX);
                    }
                }
            }

            function runFix() {
                try { replaceInTextNodes(document.body); } catch (e) { }
            }

            // Initial
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', runFix);
            } else {
                runFix();
            }

            // After AJAX loads (jQuery present in project)
            if (window.$) {
                $(document).on('ajaxComplete', runFix);
            }

            // MutationObserver to catch dynamic updates
            if (typeof MutationObserver !== 'undefined') {
                var obs = new MutationObserver(function (mutations) {
                    var shouldRun = mutations.some(function (m) { return m.addedNodes && m.addedNodes.length; });
                    if (shouldRun) {
                        // batch updates
                        clearTimeout(runFix._t);
                        runFix._t = setTimeout(runFix, 50);
                    }
                });
                obs.observe(document.body, { childList: true, subtree: true });
            }
        })();
    </script>

    <script src="//code.jquery.com/ui/1.11.0/jquery-ui.js"></script>
    <script src="~/Scripts/fusion.js"></script>
    <script src="~/Scripts/sweetalert2.all.min.js"></script>

    <script src="~/crmassets/select2/js/select2.full.min.js"></script>
    <script src="~/crmassets/select2/js/select2.min.js"></script>
    <script src="~/crmassets/forms/select2/select2.init.js"></script>

    <!----------------------------->
    @*<script src="~/Scripts/sweetalert2/dist/sweetalert2.all.min.js"></script>
        <script src="~/Scripts/sweetalert2/dist/sweetalert2.min.js"></script>
        <script src="~/Scripts/sweetalert2/sweet-alert.init.js"></script>*@
    <!---------------------------->
    @RenderSection("scripts", required: false)

    <script>
    // Global base URL handler for all images across the application
    (function() {
        function fixImageUrls() {
            var baseElement = document.getElementById('BaseUrl');
            var base = baseElement && baseElement.dataset ? baseElement.dataset.baseurl || '' : '';
            var virtualPath = baseElement && baseElement.dataset ? baseElement.dataset.virtualpath || '/sngs' : '/sngs';
            if (!base) return;
            
            var root = base.replace(/\/$/, '');
            
            // Try to detect from current URL as fallback
            var currentPath = window.location.pathname;
            if (currentPath.indexOf('/sngs/') === 0) {
                virtualPath = '/sngs';
            } else if (currentPath.indexOf('/sndp/') === 0) {
                virtualPath = '/sndp';
            }
            
            // Debug logging
            console.log('URL Fix Debug:', {
                currentPath: currentPath,
                virtualPath: virtualPath,
                root: root
            });
            
            // Fix all img tags
            document.querySelectorAll('img[src]').forEach(function(img) {
                var src = img.getAttribute('src') || '';
                
                // Skip data and blob URLs (used by client-side previews)
                if (/^(data:|blob:)/i.test(src)) {
                    return;
                }

                // Handle absolute URLs that might have wrong virtual path
                if (/^https?:\/\//i.test(src)) {
                    // Check if it has duplicate virtual path (e.g., sngs/sngs)
                    if (src.indexOf('/sngs/sngs/') > -1) {
                        var correctedUrl = src.replace('/sngs/sngs/', '/sngs/');
                        img.src = correctedUrl;
                        console.log('Fixed duplicate virtual path:', {
                            original: src,
                            corrected: correctedUrl
                        });
                    } else if (src.indexOf('/sndp/sndp/') > -1) {
                        var correctedUrl = src.replace('/sndp/sndp/', '/sndp/');
                        img.src = correctedUrl;
                        console.log('Fixed duplicate virtual path:', {
                            original: src,
                            corrected: correctedUrl
                        });
                    }
                    return;
                }
                
                // Handle relative URLs
                if (src.startsWith('~/')) src = src.replace(/^~\//, '');
                if (src.startsWith('/')) src = src.slice(1);
                
                // Construct the full URL with virtual path
                var fullUrl = root + virtualPath + '/' + src;
                img.src = fullUrl;
                
                // Debug logging
                console.log('Image URL fixed:', {
                    original: img.getAttribute('data-original-src') || 'unknown',
                    new: fullUrl,
                    root: root,
                    virtualPath: virtualPath,
                    src: src
                });
            });
            
            // Fix background images in CSS
            var styleSheets = document.styleSheets;
            for (var i = 0; i < styleSheets.length; i++) {
                try {
                    var rules = styleSheets[i].cssRules || styleSheets[i].rules;
                    if (rules) {
                        for (var j = 0; j < rules.length; j++) {
                            var rule = rules[j];
                            if (rule.style && rule.style.backgroundImage) {
                                var bgImage = rule.style.backgroundImage;
                                if (bgImage && !bgImage.match(/^https?:\/\//i) && bgImage.includes('url(')) {
                                    var urlMatch = bgImage.match(/url\(['"]?([^'"]+)['"]?\)/);
                                    if (urlMatch) {
                                        var url = urlMatch[1];
                                        if (!url.match(/^https?:\/\//i)) {
                                            if (url.startsWith('~/')) url = url.replace(/^~\//, '');
                                            if (url.startsWith('/')) url = url.slice(1);
                                            rule.style.backgroundImage = bgImage.replace(urlMatch[1], root + virtualPath + '/' + url);
                                        }
                                    }
                                }
                            }
                        }
                    }
                } catch (e) {
                    // Skip cross-origin stylesheets
                }
            }
        }
        
        // Run immediately
        fixImageUrls();
        
        // Run on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', fixImageUrls);
        } else {
            fixImageUrls();
        }
        
        // Run after AJAX content loads (for dynamic content)
        $(document).on('ajaxComplete', fixImageUrls);
        
        // Run more frequently for the first few seconds to catch any late-loading content
        var runCount = 0;
        var quickInterval = setInterval(function() {
            fixImageUrls();
            runCount++;
            if (runCount >= 10) { // Run 10 times quickly (every 100ms)
                clearInterval(quickInterval);
            }
        }, 100);
        
        // Also run periodically for dynamically added content
        setInterval(fixImageUrls, 2000);
        
        // Use MutationObserver to catch dynamically added images
        if (typeof MutationObserver !== 'undefined') {
            var observer = new MutationObserver(function(mutations) {
                var shouldFix = false;
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList') {
                        mutation.addedNodes.forEach(function(node) {
                            if (node.nodeType === 1) { // Element node
                                if (node.tagName === 'IMG' || node.querySelector && node.querySelector('img')) {
                                    shouldFix = true;
                                }
                            }
                        });
                    }
                });
                if (shouldFix) {
                    setTimeout(fixImageUrls, 50);
                }
            });
            
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        }
    })();
    </script>

    <div class="footer bg-warning">
        <p>&copy; 2025 Developed and Maintained by <a href="https://fusiontecsoftware.com/" target="_blank" rel="noopener">FusiontecSoftware</a>. All rights reserved.</p>
    </div>
</body>
</html>
